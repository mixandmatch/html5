<!DOCTYPE HTML>
<html>
    <head>
        <title>Mix and Match mit jQuery Mobile</title>

        <script type="text/javascript" src="../../js/CommonHeaderLibs.js"></script>
		<script type="text/javascript" src="../../js/DatePickerLibs.js"></script>
		<script type="text/javascript" src="../../js/CommonHeaderInit.js"></script>

		<!-- 
		<script type="text/javascript" src="../../js/lib/jquery.scroller-1.0.2.min.js"></script>
		<link rel="stylesheet" href="../../css/jqm/jquery.scroller-1.0.2.min.css" type="text/css"></link>
		-->

        <script type="text/javascript">

            $(document).ready(function(){
                var storageService = new StorageService();

                // try to load the old values
                var userRequestObject = storageService.getSavedUserRequestObject();
                $('#name').val(userRequestObject.name);
                $('#email').val(userRequestObject.email);
                $('#date').val(Utils.convertInternalDateToGuiDate(userRequestObject.date));
                $('#select-choice-1').val(userRequestObject.place);

                //-------------------------------------------------------------------------
                // DatePicker functionality
                // http://pinoytech.org/question/4886672/jquery-mobile-override-jquery-ui-datepicker-layout-broken
				/*
				 */
                $('#date').next().hide();

                $('#date').focus(function() {
                    $('#date').next().show('slow');
                });

				/*
				mobiscroller: http://code.google.com/p/mobiscroll/
				$('#date').scroller();
				 */


                // .live() event importantor else clicks stop functioning
                $( '.ui-body-c a' ).live('click', function() {
                    $( '#date' ).next().hide('slow');
                });

                //-------------------------------------------------------------------------

                // bind "checkin()" method of MixAndMatch to the click event of the button
                $('#checkinButton').click(function(){
                    // save the attributes in the local storage
                    var userRequestObject = new UserRequestObject();

                    userRequestObject.name = $('#name').val();
                    userRequestObject.email = $('#email').val();
                    userRequestObject.date = Utils.convertGuiDateToInternalDate($('#date').val());
                    userRequestObject.place = $('#location-choice').val();

                    // save the object in the local storage
                    storageService.saveUserRequestObject(userRequestObject);
					mixAndMatch.createLunchRequest(callback, userRequestObject);

                    alert('Check in successful!');
                });

				//                var remoteService = new RemoteService();
				//                var mixAndMatch = new MixAndMatch(remoteService);
                mixAndMatch.getLocations(showLocations);
            });

            function showLocations(responseDataArray) {

                $.each(responseDataArray, function(i, j){
                    var row = "<option value=\"" + j.key + "\">" + j.label + "</option>";
                    $(row).appendTo("select#location-choice");
                });

                $("#location-choice").selectmenu('refresh', true);
            }
			
			function callback(responseDataArray) {
				log.debug("createLunchRequest response: ", JSON.stringify(responseDataArray));
            }

        </script>

    </head>
    <body>

        <div data-role="page">
            <div data-role="header" data-theme="b">
                <a href="index.html" rel="external" data-role="button" data-theme="b" data-icon="arrow-l" data-iconpos="left">Back</a>
                <h1>Check in</h1>
            </div>

            <div data-role="content">
                <div data-role="fieldcontain">
                    <label for="name">Name:</label>
                    <input type="text" name="name" id="name" value="" />
                </div>
                <div data-role="fieldcontain">
                    <label for="email">Email:</label>
                    <input type="email" name="email" id="email" value="" />
                </div>
                <div data-role="fieldcontain">
                    <label for="date">Date Input:</label>
                    <input type="date" name="date" id="date" value="" />
                </div>
                <div data-role="fieldcontain">
                    <label for="location-choice" class="select">Default Ort:</label>
                    <select name="location-choice" id="location-choice"></select>
                </div>
                <button id="checkinButton">Check in</button>
            </div>

            <div data-role="footer">
                <h4>HTML5-Team</h4>
            </div>
        </div>
    </body>
</html>