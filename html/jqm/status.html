<!DOCTYPE HTML>
<html>
    <head>
        <title>Mix and Match mit jQuery Mobile</title>

        <script type="text/javascript" src="../../js/CommonHeaderLibs.js"></script>
		<script type="text/javascript" src="../../js/CommonHeaderInit.js"></script>

        <script type="text/javascript">
 		
            $(document).ready(function(){
        		
                var storageService = new StorageService();
                var userRequestData = storageService.getSavedUserRequestObject();
                showUserRequestObject(userRequestData);
                
				// get the lunch response
                //mixAndMatch.getAllLunchRequests(showResponse);
				mixAndMatch.getLunchRequestsByUser(showUserRequests, userRequestData.name);
            });
 		
            function showUserRequestObject(userRequestData){
                $('#requestData').html(
                userRequestData.name + ", " +
                    userRequestData.email + ", "+
                    Utils.convertDate(userRequestData.date, Utils.dateFormatInternal, Utils.dateFormatGui) + ", " +
                    userRequestData.place);
			}
			
			function showUserRequests(userRequestsData) {
				log.debug('log showUserRequests()');
				
				var content = '<table border="1">';
				$.each(userRequestsData, function(index, entry) {
					log.debug('log entry:', index);
					content += '<tr>';
					content += '<td>' +Utils.convertDate(entry.date, Utils.dateFormatInternal, Utils.dateFormatGui)+ '</td>';
					content += '<td>' +mixAndMatch.getLocationName(entry.locationKey)+ '</td>';
					content += '<td><a href="javascript:showDetailInformations(\''+entry.matchUrl+'\')">Teilnehmerliste</a></td>';
					content += '</tr>';
				});
				content += '</table>';

                $('#responseData').html(content);
            }
			
			function showDetailInformations(pMatchUrl) {
				log.debug('log showDetailInformations() matchUrl:', pMatchUrl);
				
				mixAndMatch.getMatchDetails(function(pMatchDetails) {

					var content = '<table border="1">';
					$.each(pMatchDetails, function(index, entry) {
						log.debug('log entry:', index);
						content += '<tr>';
						content += '<td>' +entry.userid+ '</td>';
						content += '</tr>';
					});
					content += '</table>';

					$('#detailData').html(content);
					
				}, pMatchUrl);
            }
			
        </script>
    </head>
    <body>

        <div data-role="page">
            <div data-role="header" data-theme="b">
                <a href="index.html" rel="external" data-role="button" data-theme="b" data-icon="arrow-l" data-iconpos="left">Back</a>
                <h1>Request Status</h1>
            </div>

            <div data-role="content">
                <div>
					Ihre letzte Anmeldung:
                </div>
                <div id="requestData">
                    <!-- will be filled by javascript -->
                </div>
                <br/>
                <div>
					Ihre anstehenden Verabredungen:
                </div>
                <div id="responseData">
                    <!-- will be filled by javascript -->
                </div>
                <br/>
                <div>
					Teilnehmer:
                </div>
                <div id="detailData">
                    <!-- will be filled by javascript -->
                </div>
            </div>

            <div data-role="footer">
                <h4>HTML5-Team</h4>
            </div>
        </div>
    </body>
</html>